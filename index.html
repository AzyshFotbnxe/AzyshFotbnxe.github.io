<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>投钱概率计算器</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/ui-lightness/jquery-ui.css">
<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif}
body{margin:0;background:#f5f7fa;color:#334155;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.container{max-width:900px;width:100%;background:#ffffff;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,.08);padding:25px}
header{text-align:center;margin-bottom:25px;border-bottom:1px solid #e2e8f0;padding-bottom:15px}
h1{font-size:2.2rem;margin:0 0 8px;color:#0f172a}
.subtitle{font-size:1rem;color:#64748b;max-width:600px;margin:0 auto}
.settings-panel{background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:20px;margin-bottom:20px}
.panel-title{font-size:1.3rem;margin:0 0 15px;color:#0ea5e9;display:flex;align-items:center;gap:8px}
.toggle-container{display:flex;align-items:center;margin-bottom:15px;background:#f1f5f9;border-radius:8px;padding:12px 15px}
.toggle-label{font-size:1rem;margin-right:12px;color:#334155}
.toggle-switch{position:relative;display:inline-block;width:52px;height:26px}
.toggle-switch input{opacity:0;width:0;height:0}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:#cbd5e1;transition:.3s;border-radius:26px}
.slider:before{position:absolute;content:"";height:20px;width:20px;left:3px;bottom:3px;background:#fff;transition:.3s;border-radius:50%}
input:checked+.slider{background:#38bdf8}
input:checked+.slider:before{transform:translateX(26px)}
.total-coins{text-align:center;font-size:1.1rem;margin:15px 0;padding:12px;background:#f1f5f9;border-radius:8px;color:#334155}
.total-coins span{font-weight:600;color:#0ea5e9}
.coins-control{display:flex;flex-direction:column;gap:15px}
.distribution-slider-container{background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:18px}
.distribution-title{font-size:1.2rem;margin:0 0 15px;color:#0ea5e9;text-align:center}
.distribution-visualization{display:flex;height:50px;border-radius:8px;overflow:hidden;border:1px solid #e2e8f0;margin-bottom:15px;position:relative}
/* 修改为纯色 - 移除渐变 */
.hua-segment{background:#fcd34d}
.heng-segment{background:#6ee7b7}
.li-segment{background:#f9a8d4}
.distribution-labels{display:flex;gap:12px;margin-top:12px}
.coin-count-box{flex:1;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:8px;padding:12px;display:flex;flex-direction:column;align-items:center}
.coin-count-label{font-size:.95rem;color:#475569;margin-bottom:4px}
.coin-count-value{font-size:1.2rem;font-weight:600;width:100%;text-align:center;border:1px solid #d1d5db;border-radius:5px;padding:4px;background:#fff;color:#334155}
/* 输入框错误样式 */
.coin-count-value.error{border-color:#ef4444;box-shadow:0 0 0 2px rgba(239,68,68,.2);animation:shake .3s}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
/* 滑动条容器 */
.distribution-slider-container{position:relative;margin:0 0 8px}
.slider-container{position:relative;height:30px;margin-top:15px}
.slider-label{display:flex;justify-content:space-between;font-size:.9rem;color:#475569;margin-bottom:6px}
.ui-slider{background:transparent;border:none;height:6px;border-radius:3px;margin-top:10px}
.ui-slider-handle{height:20px;width:20px;border-radius:50%;background:#38bdf8;border:2px solid #fff;top:-7px;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.15)}
.ui-slider-range{background:transparent}
.slider-handle-label{position:absolute;padding:4px 10px;background:#38bdf8;color:#fff;border-radius:20px;font-size:.85rem;white-space:nowrap;transform:translateX(-50%);cursor:grab;z-index:10;user-select:none;box-shadow:0 2px 6px rgba(0,0,0,.15)}
.slider-handle-label.ui-draggable-dragging{cursor:grabbing;transform:translateX(-50%) scale(1.05)}
/* 调整标签位置 */
#huaLabel{top:-35px}
#liLabel{bottom:-35px}
.range-container{display:flex;gap:15px;flex-wrap:wrap}
.range-slider{flex:1 1 250px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:15px}
.range-title{font-size:1.2rem;margin:0 0 12px;color:#0ea5e9;display:flex;align-items:center;gap:8px;justify-content:center}
.range-description{font-size:1rem;text-align:center;color:#64748b;margin-bottom:18px}
.calculate-btn{width:100%;padding:15px;font-size:1.2rem;font-weight:600;border:none;border-radius:8px;background:#38bdf8;color:#fff;cursor:pointer;transition:.3s;margin:20px 0}
.calculate-btn:hover{background:#0284c7}
.result-container{text-align:center;padding:20px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px}
.result-title{font-size:1.3rem;margin:0 0 10px;color:#0ea5e9}
.result-value{font-size:2.5rem;font-weight:700;padding:15px;border-radius:8px;max-width:400px;margin:10px auto;color:#0f172a;background:#fff;border:1px solid #e2e8f0}
.low-prob{color:#ef4444;border-left:5px solid #ef4444}
.mid-prob{color:#f59e0b;border-left:5px solid #f59e0b}
.high-prob{color:#10b981;border-left:5px solid #10b981}
.detail-header{display:flex;justify-content:space-between;align-items:center;background:#f1f5f9;border:1px solid #e2e8f0;border-bottom:none;padding:12px 15px;border-radius:8px 8px 0 0;cursor:pointer}
.detail-title{font-size:1.2rem;margin:0;color:#0ea5e9}
.detail-content{padding:15px;background:#f8fafc;border:1px solid #e2e8f0;border-top:none;border-radius:0 0 8px 8px;font-family:monospace;font-size:.95rem;line-height:1.5;color:#334155;max-height:300px;overflow-y:auto}
.footer{text-align:center;margin-top:25px;font-size:.9rem;color:#94a3b8}
/* 错误提示 */
.error-message{color:#ef4444;text-align:center;margin-top:10px;font-size:.9rem;display:none}
/* 合并可视化与滑动条 */
.visualization-slider-container {
  position: relative;
  margin-bottom: 40px;
}
.visualization-slider {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 50px;
  z-index: 1;
}
.slider-below-visualization {
  position: relative;
  z-index: 2;
  margin-top: 50px;
}
/* 隐藏滑动条本体 */
#distributionSlider {
  background: transparent !important;
  border: none !important;
  height: 50px !important;
  margin-top: 0 !important;
}
#distributionSlider .ui-slider-range,
#distributionSlider .ui-slider-track {
  display: none !important;
}
/* 调整滑动块样式 */
#distributionSlider .ui-slider-handle {
  top: 25px !important;
  height: 24px;
  width: 24px;
  border: 3px solid #fff;
  background: #38bdf8;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
/* 调整标签样式 */
.slider-handle-label {
  font-weight: bold;
  padding: 5px 12px;
  background: #38bdf8;
  color: white;
  border-radius: 16px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}

/* 新增：目标范围滑动条样式修改 */
.ui-widget-content {
  background: #e2e8f0;
  height: 6px;
  border-radius: 3px;
}
.ui-slider-range {
  background: #38bdf8 !important;
  height: 6px;
  border-radius: 3px;
}
.ui-slider-handle {
  height: 20px !important;
  width: 20px !important;
  border-radius: 50% !important;
  background: #38bdf8 !important;
  border: 2px solid #fff !important;
  top: -7px !important;
  cursor: pointer !important;
  box-shadow: 0 2px 4px rgba(0,0,0,.15) !important;
}
</style>
</head>
<body>
<div class="container">
<header>
  <h1><i class="fas fa-coins"></i> 界园肉鸽投钱概率计算器</h1>
  <p class="subtitle">我不想算排列组合了，也不想当产品经理了</p>
</header>

<div class="settings-panel">
  <h2 class="panel-title"><i class="fas fa-sliders-h"></i> 基本设置</h2>

  <div class="toggle-container">
    <span class="toggle-label">游客分队：</span>
    <label class="toggle-switch">
      <input type="checkbox" id="visitorMode">
      <span class="slider"></span>
    </label>
    <span id="visitorLabel" style="margin-left:10px;color:#334155">否</span>
  </div>

  <div class="total-coins">
    总钱数：<span id="totalCoins">10</span> 枚 / 抽取：<span id="drawCount">3</span> 枚
  </div>

  <div class="distribution-slider-container">
    <h3 class="distribution-title">钱币分布</h3>
    
    <div class="visualization-slider-container">
      <div class="distribution-visualization visualization-slider">
        <div class="hua-segment" id="huaSegment" style="flex-grow:4"></div>
        <div class="heng-segment" id="hengSegment" style="flex-grow:3"></div>
        <div class="li-segment" id="liSegment" style="flex-grow:3"></div>
      </div>
      
      <div id="distributionSlider"></div>
      <div class="slider-handle-label" id="huaLabel">花钱：4</div>
      <div class="slider-handle-label" id="liLabel">厉钱：3</div>
    </div>

    <div class="distribution-labels">
      <div class="coin-count-box">
        <div class="coin-count-label">花钱</div>
        <input type="number" class="coin-count-value" id="huaInput" value="4" min="0">
      </div>
      <div class="coin-count-box">
        <div class="coin-count-label">衡钱</div>
        <input type="number" class="coin-count-value" id="hengInput" value="3" min="0">
      </div>
      <div class="coin-count-box">
        <div class="coin-count-label">厉钱</div>
        <input type="number" class="coin-count-value" id="liInput" value="3" min="0">
      </div>
    </div>
    
    <div id="errorMessage" class="error-message">钱币总数必须等于总钱数！</div>
  </div>
</div>

<div class="target-range">
  <h2 class="range-title"><i class="fas fa-bullseye"></i> 目标范围</h2>
  <p class="range-description">设置抽取结果中各类钱币的数量范围</p>
  <div class="range-container">
    <div class="range-slider">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
        <i class="fas fa-money-bill-wave" style="color:#f59e0b"></i>
        <span style="font-weight:600">花钱</span>
      </div>
      <div class="slider-container">
        <div class="slider-label">
          <span>0</span>
          <span id="huaRangeValue">0-3</span>
          <span id="huaRangeMax">3</span>
        </div>
        <div id="huaRangeSlider"></div>
      </div>
    </div>
    <div class="range-slider">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
        <i class="fas fa-balance-scale" style="color:#34d399"></i>
        <span style="font-weight:600">衡钱</span>
      </div>
      <div class="slider-container">
        <div class="slider-label">
          <span>0</span>
          <span id="hengRangeValue">0-3</span>
          <span id="hengRangeMax">3</span>
        </div>
        <div id="hengRangeSlider"></div>
      </div>
    </div>
    <div class="range-slider">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
        <i class="fas fa-coins" style="color:#f472b6"></i>
        <span style="font-weight:600">厉钱</span>
      </div>
      <div class="slider-container">
        <div class="slider-label">
          <span>0</span>
          <span id="liRangeValue">0-3</span>
          <span id="liRangeMax">3</span>
        </div>
        <div id="liRangeSlider"></div>
      </div>
    </div>
  </div>
</div>

<button id="calculateBtn" class="calculate-btn"><i class="fas fa-calculator"></i> 计算概率</button>

<div class="result-container">
  <h3 class="result-title">计算结果</h3>
  <div id="resultValue" class="result-value mid-prob">0.0000%</div>
  <div>满足条件的概率</div>
</div>

<div class="detail-section">
  <div class="detail-header" id="detailToggle">
    <h3 class="detail-title"><i class="fas fa-chart-line"></i> 详细计算过程</h3>
    <i class="fas fa-chevron-down"></i>
  </div>
  <div class="detail-content" id="detailContent" style="display:none">
    <pre id="calculationDetails">点击"计算概率"后显示详细算式…</pre>
  </div>
</div>

<div class="footer">
  投钱概率计算器 &copy; 2025 | 柔和浅色主题 | 优化版
</div>
</div>

<script>
$(function(){
  // 初始化变量
  let visitor = false, total = 10, draw = 3;
  let hua = 4, heng = 3, li = 3, sp1 = 4, sp2 = 7;
  
  /* ===== 通用刷新函数 ===== */
  function refreshAll(){
    // 更新钱币数量
    hua = sp1;
    heng = sp2 - sp1;
    li = total - sp2;
    
    // 更新滑块位置
    $('#distributionSlider').slider('values', [sp1, sp2]);
    
    // 更新输入框值
    $('#huaInput').val(hua);
    $('#hengInput').val(heng);
    $('#liInput').val(li);
    
    // 更新可视化部分
    $('#huaSegment').css('flex-grow', hua);
    $('#hengSegment').css('flex-grow', heng);
    $('#liSegment').css('flex-grow', li);
    
    // 更新标签位置和文本
    const sliderWidth = $('#distributionSlider').width();
    $('#huaLabel').text(`花钱：${hua}`).css('left', (sp1/total)*sliderWidth);
    $('#liLabel').text(`厉钱：${li}`).css('left', (sp2/total)*sliderWidth);
    
    // 隐藏错误提示
    $('#errorMessage').hide();
    $('.coin-count-value').removeClass('error');
  }
  
  /* ===== 更新标签位置 ===== */
  function updateLabelPos(){
    const sliderWidth = $('#distributionSlider').width();
    $('#huaLabel').css('left', (sp1/total)*sliderWidth);
    $('#liLabel').css('left', (sp2/total)*sliderWidth);
  }

  /* ===== 滑块 & 标签拖拽 ===== */
  $('#distributionSlider').slider({
    range: true,
    min: 0,
    max: total,
    values: [sp1, sp2],
    slide: (_, ui) => {
      sp1 = ui.values[0];
      sp2 = ui.values[1];
      refreshAll();
    }
  });
  
  $('.slider-handle-label').draggable({
    axis: 'x',
    containment: 'parent',
    drag: (_, ui) => {
      const sliderWidth = $('#distributionSlider').width();
      const v = Math.round(ui.position.left/sliderWidth*total);
      if($(ui.helper).is('#huaLabel')){
        sp1 = Math.max(0, Math.min(v, sp2-1));
      } else {
        sp2 = Math.min(total, Math.max(v, sp1+1));
      }
      refreshAll();
    }
  });

  /* ===== 范围滑块初始化 ===== */
  function initRange(){
    ['hua','heng','li'].forEach(c => {
      $(`#${c}RangeSlider`).slider({
        range: true,
        min: 0,
        max: draw,
        values: [0, Math.min(draw, eval(c))],
        slide: (_, ui) => {
          $(`#${c}RangeValue`).text(ui.values.join('-'));
          // 更新范围滑块的蓝色区域
          $(`#${c}RangeSlider .ui-slider-range`).css({
            'left': `${(ui.values[0]/draw)*100}%`,
            'width': `${((ui.values[1]-ui.values[0])/draw)*100}%`
          });
        }
      });
      $(`#${c}RangeValue`).text(`0-${Math.min(draw, eval(c))}`);
      // 初始化范围滑块的蓝色区域
      const values = $(`#${c}RangeSlider`).slider('values');
      $(`#${c}RangeSlider .ui-slider-range`).css({
        'left': `${(values[0]/draw)*100}%`,
        'width': `${((values[1]-values[0])/draw)*100}%`
      });
    });
  }
  initRange();

  /* ===== 游客模式切换 ===== */
  $('#visitorMode').on('change', function(){
    visitor = this.checked;
    $('#visitorLabel').text(visitor ? '是' : '否');
    total = visitor ? 12 : 10;
    draw = visitor ? 5 : 3;
    
    // 更新UI显示
    $('#totalCoins').text(total);
    $('#drawCount,#huaRangeMax,#hengRangeMax,#liRangeMax').text(draw);
    
    // 更新滑块最大值
    $('#distributionSlider').slider('option', 'max', total);
    
    // 调整分界点确保有效
    sp1 = Math.min(sp1, total-2);
    sp2 = Math.min(sp2, total-1);
    if(sp2-sp1 < 0) sp2 = sp1+1;
    
    refreshAll();
    initRange();
  });

  /* ===== 输入框处理 ===== */
  function adjustCoinValues(changedInput) {
    // 获取当前输入值
    let newHua = parseInt($('#huaInput').val()) || 0;
    let newHeng = parseInt($('#hengInput').val()) || 0;
    let newLi = parseInt($('#liInput').val()) || 0;
    
    // 确保非负
    newHua = Math.max(0, newHua);
    newHeng = Math.max(0, newHeng);
    newLi = Math.max(0, newLi);
    
    // 计算总和差异
    const sum = newHua + newHeng + newLi;
    const diff = sum - total;
    
    if (diff !== 0) {
      // 根据修改的输入类型调整其他值
      if (changedInput === 'hua') {
        // 修改花钱时优先调整衡钱
        if (diff > 0) {
          newHeng = Math.max(0, newHeng - diff);
        } else {
          newHeng = newHeng - diff; // diff为负，所以是加
        }
      } else if (changedInput === 'heng') {
        // 修改衡钱时优先调整厉钱
        if (diff > 0) {
          newLi = Math.max(0, newLi - diff);
        } else {
          newLi = newLi - diff; // diff为负，所以是加
        }
      } else if (changedInput === 'li') {
        // 修改厉钱时优先调整花钱
        if (diff > 0) {
          newHua = Math.max(0, newHua - diff);
        } else {
          newHua = newHua - diff; // diff为负，所以是加
        }
      }
      
      // 再次确保非负
      newHua = Math.max(0, newHua);
      newHeng = Math.max(0, newHeng);
      newLi = Math.max(0, newLi);
      
      // 更新输入框
      $('#huaInput').val(newHua);
      $('#hengInput').val(newHeng);
      $('#liInput').val(newLi);
    }
    
    // 更新内部变量
    hua = newHua;
    heng = newHeng;
    li = newLi;
    sp1 = hua;
    sp2 = hua + heng;
    
    // 确保sp2在合理范围内
    if (sp2 > total) sp2 = total;
    if (sp2 < sp1) sp2 = sp1 + 1;
    
    // 刷新UI
    refreshAll();
  }
  
  // 绑定输入框事件
  $('#huaInput').on('input', function() {
    adjustCoinValues('hua');
  });
  
  $('#hengInput').on('input', function() {
    adjustCoinValues('heng');
  });
  
  $('#liInput').on('input', function() {
    adjustCoinValues('li');
  });

  /* ===== 概率计算（含算式） ===== */
  function comb(n, k) {
    if (k < 0 || k > n) return 0;
    let r = 1;
    for (let i = 1; i <= k; i++) {
      r = r * (n - i + 1) / i;
    }
    return Math.round(r);
  }
  
  $('#calculateBtn').on('click', function() {
    // 获取当前范围值
    const hMin = $('#huaRangeSlider').slider('values')[0];
    const hMax = $('#huaRangeSlider').slider('values')[1];
    const eMin = $('#hengRangeSlider').slider('values')[0];
    const eMax = $('#hengRangeSlider').slider('values')[1];
    const lMin = $('#liRangeSlider').slider('values')[0];
    const lMax = $('#liRangeSlider').slider('values')[1];
    
    // 计算总组合数
    const T = comb(total, draw);
    let prob = 0;
    let detail = `计算过程：\n`;
    detail += `总钱数: ${total} (花钱${hua}, 衡钱${heng}, 厉钱${li})\n`;
    detail += `抽取: ${draw} 枚  目标范围: 花钱[${hMin},${hMax}] 衡钱[${eMin},${eMax}] 厉钱[${lMin},${lMax}]\n\n符合条件的组合：\n`;
    
    let cases = 0;
    for (let x = Math.max(0, draw-heng-li); x <= Math.min(hua, draw); x++) {
      for (let y = Math.max(0, draw-x-li); y <= Math.min(heng, draw-x); y++) {
        const z = draw - x - y;
        if (z < 0 || z > li) continue;
        if (x >= hMin && x <= hMax && y >= eMin && y <= eMax && z >= lMin && z <= lMax) {
          const c1 = comb(hua, x);
          const c2 = comb(heng, y);
          const c3 = comb(li, z);
          const p = c1 * c2 * c3 / T;
          prob += p;
          cases++;
          detail += ` - 花钱${x} 衡钱${y} 厉钱${z}  →  C(${hua},${x})×C(${heng},${y})×C(${li},${z}) / C(${total},${draw}) = ${(p*100).toFixed(4)}%\n`;
        }
      }
    }
    
    detail += `\n共 ${cases} 种  总概率 ${(prob*100).toFixed(4)}%`;
    
    // 更新结果
    $('#resultValue').text((prob*100).toFixed(4)+'%')
      .toggleClass('low-prob', prob < 0.5)
      .toggleClass('mid-prob', prob >= 0.5 && prob <= 0.8)
      .toggleClass('high-prob', prob > 0.8);
    
    $('#calculationDetails').text(detail);
  });

  // 详细计算过程切换
  $('#detailToggle').on('click', function() {
    $('#detailContent').slideToggle();
    $(this).find('i').toggleClass('fa-chevron-down fa-chevron-up');
  });

  // 初始刷新和窗口大小调整事件
  refreshAll();
  $(window).on('resize', updateLabelPos);
});
</script>
</body>
</html>